name: Release and Publish

on:
  workflow_dispatch:
    inputs:
      release_type:
        description: 'Release type (patch, minor, major, or manual)'
        required: true
        default: 'patch'
        type: choice
        options:
          - patch
          - minor
          - major
          - manual
      custom_version:
        description: 'Custom version (only for manual release type, e.g., 1.0.0)'
        required: false
        type: string

jobs:
  release-and-publish:
    uses: ai-pipestream/.github/.github/workflows/reusable-service-release.yml@main
    with:
      release_type: ${{ inputs.release_type }}
      custom_version: ${{ inputs.custom_version }}
      docker-image-name: s3-connector
      maven-artifact-id: s3-connector
      dockerfile-path: src/main/docker/Dockerfile.jvm
    secrets:
      BUF_TOKEN: ${{ secrets.BUF_TOKEN }}
      GPG_PRIVATE_KEY: ${{ secrets.GPG_PRIVATE_KEY }}
      GPG_PASSPHRASE: ${{ secrets.GPG_PASSPHRASE }}
      MAVEN_CENTRAL_USERNAME: ${{ secrets.MAVEN_CENTRAL_USERNAME }}
      MAVEN_CENTRAL_PASSWORD: ${{ secrets.MAVEN_CENTRAL_PASSWORD }}
      DISPATCH_TOKEN: ${{ secrets.DISPATCH_TOKEN }}
      DOCKER_USER: ${{ secrets.DOCKER_USER }}
      DOCKER_TOKEN: ${{ secrets.DOCKER_TOKEN }}
